# OSIM_v5 version 1.0.001
Synthetic Health Data Generator - OMOP CDM v5 version for OSIM simulator 

##   Description
Generate synthetic cohorts, with certain conditions or drugs. This process is based on SQL generated by ATLAS. 

## Additional Documentation
For more information about version 5, please check the enclosed presentation.

Please refer to the documentation available in v2 Documentation folder, or the paper avaibale at: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3243118/ for more information about the initial version.

## Execution Process

The execution process for generating cohorts is similar to the OSIM process mentioned in brach master, with two additional steps.

### Step 1: Edit Views
**Modify first 4 views in OSIM5_views.sql**  

### Step 2: Create Views
**Run OSIM5_views.sql file**  
 
### Step 3 (Optional): User Modifiable Range Functions
**Modify range functions in OSIM5_package.sql**  

### Step 4: Table Generation
**Run OSIM5_tables.sql file**  

### Step 5: Analysis Phase: analyze_source_db()
**Run stored procedure (analyze_source_db)**  
  
### Step 6: Modify constaints for cohort
**Modify OSIM5_modify.sql**  
</br>
Change initialization as required, to reflect the constraints for the cohort. Currently, you can specify the following conditions

1. Age: Modify parameters AGE_LESS_THAN and AGE_GREATER_THAN. The ages in the cohort will be constrained using  
AGE_GREATER_THAN < age in cohort < AGE_LESSER_THAN

2. Initial condition: One concept code can be specified in CONDITION_CONCEPT, which determines the initial condition of the patients within the cohort. Like ATLAS, the ancestors and descendants are also included. 

3. Interval Period: Change value in INTERVAL PERIOD (same as ATLAS)

4. Drugs : In progress

### Step 6: Modify transitional probabilities 
**Run the OSIM5_modify.sql file and the stored procedure(modify_prob)**  
</br>
Executing the OSIM5_modify.sql file creates a stored procedure, modify_prob(). When this stored proedure is called,
it modifies the transitional probabilities generated in the analysis phase to reflect the cohort conditions.

### Step 6: Simulated Data: ins_sim_data(person_count,person_start_id)
**Run stored procedure (ins_sim_data)**  
   
### Step 7(Optional): Outcomes

In Progress
   
### Step 8(Optional): Copy Data

In Progress

## Other OSIM Methods

    delete_all_sim_data() -- will delete all data from "osim_" prefixed tables
    
    
    drop_osim_indexes() -- will drop all indexes from "osim_" prefixed tables
    
    
    create_osim_indexes() -- will create all indexes from "osim_" prefixed tables


## Simulation Scenarios

   All command blocks should be executed inside PostgreSQL


   ======================================================================== <br/>
   Simple non-parallel analysis and simulation of 100,000 persons <br/>
   ```
   begin
      perform analyze_source_db();
      peform ins_sim_data(100000);
   end;
   ```
   
   ========================================================================<br/>
   Analysis and parallel simulation of 50,000 persons (2 x 250,000) <br/>
   _Note: ANALYSIS MUST COMPLETE BEFORE STARTING SIMULATIONS_
   ```
   begin
      perform analyze_source_db();
   end;
   


   -- Parallel Simulation 1
   begin
      perform ins_sim_data(250000,1);
   end;
  


   -- Parallel Simulation 2
   begin
     perform ins_sim_data(250000,250001);
   end; <br/> 
   
   ```
